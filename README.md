# IOspeedtest

Test C++ iostream speed,  and the impaction of sync_with_stdio()  and cin.tie()

[BLog](https://liyzcj.github.io/c++/2015/09/12/c++-test_cin_speed/)

## æ‘˜è¦

å®éªŒä¸ƒä¸»è¦æ˜¯æµ‹è¯•ä¸åŒæ–¹æ³•è¯»å–é€Ÿåº¦çš„ä¸åŒ.

é€šè¿‡å¯¹ä¸åŒçš„æ–¹æ³•æµ‹é€Ÿ, äº†è§£ `ios::sync_with_stdio(false)` ä¸ `iOS::tie()`å¯¹cin å‡½æ•°è¯»å…¥é€Ÿåº¦çš„å½±å“.

å…¶ä¸­ `ios::sync_with_stdio()` ä¸»è¦æ˜¯ä¸ºäº†å®ç° cin/cout ä¸ cè¯­è¨€çš„ scanf/pringfçš„åŒæ­¥, æ„æ€å°±æ˜¯åœ¨è¯»å–æ–‡ä»¶æ—¶çš„æŒ‡é’ˆæ˜¯åŒæ­¥çš„, æ–¹ä¾¿ä¸¤ä¸ªå‡½æ•°æ··ç”¨.

è€Œ `ios::tie()` æ˜¯ç»‘å®šè¾“å…¥è¾“å‡ºæµ, é»˜è®¤ cin ä¸ cout æ˜¯ç»‘å®šåœ¨ä¸€èµ·. ç»‘å®šçš„æ„æ€å³æ¯å½“ä¸€ä¸ªå¯¹è±¡æœ‰è¾“å…¥è¾“å‡ºæ“ä½œæ—¶, å°±ä¼šåŒæ­¥åˆ·æ–°ç»‘å®šå¯¹è±¡çš„ streambuf.

å®éªŒè¿‡ç¨‹: é¦–å…ˆä½¿ç”¨ `generate()` å‡½æ•°ç”Ÿæˆ 1000,0000 ä¸ªæ•´æ•°å­˜å…¥ `data.txt`.

ç„¶åå†ä½¿ç”¨ `evaluate()` å‡½æ•°æ¥è¯„ä¼°ä¸åŒæ–¹æ³•çš„è¯»å–æ‰€æ¶ˆè€—çš„æ—¶é—´.

## ä½¿ç”¨æ–¹æ³•

æ‰€æœ‰æ–¹æ³•å¦‚ä¸‹åç§:

| ä»£å·         | æè¿°                                       |
|--------------|--------------------------------------------|
| cin          | freopen()åˆ°stdin, å†ç”¨cinè¯»å–è¯»å–;         |
| scanf        | freopen()åˆ°stdin, å†ç”¨scanfè¯»å–;           |
| fread        | ä½¿ç”¨fread() è¯»å–æ•´ä¸ªå­—ç¬¦ä¸²å†å¤„ç†           |
| read         | ä½¿ç”¨read() è¯»å–æ•´ä¸ªå­—ç¬¦ä¸²å†å¤„ç†            |
| mmap         | ä½¿ç”¨mmap()æ˜ å°„è¿›å†…å­˜å†å¤„ç†                 |
| pascal       | ä½¿ç”¨pascalè¯»å–                             |
| ifstream     | ç›´æ¥ä½¿ç”¨ifstreamè¯»å–æ–‡ä»¶;                  |
| cin~sync     | ä½¿ç”¨cin,å¹¶å…³é—­ sync_with_stdio(); å…³é—­åŒæ­¥ |
| cin~tie      | ä½¿ç”¨cin, å¹¶å…³é—­ cin.tie(); è§£é™¤ç»‘å®š        |
| cin\~tie\~sync | ç­‰ä»·äº cin\~sync + cin\~tie                  |

ğŸ’¡ æ³¨æ„: ä¸å¯åœ¨ä¸€æ¬¡è¯„æµ‹ä¸­è¯„æµ‹ cin~sync cin~tie cin\~tie\~sync cin. 
å› ä¸º tie(NULL); sync_with_stdio(false); æ‰§è¡Œåä¼šä¸€ç›´æœ‰æ•ˆ

ä½¿ç”¨æ–¹æ³•:

  1. è¿è¡Œç¯å¢ƒ: Linux

  2. ç¬¬ä¸€æ¬¡è¿è¡Œä¼šç”Ÿæˆ `data.txt`.

  3. ç›´æ¥ä¿®æ”¹ç¨‹åºçš„ vector é€‰æ‹©è¦è¯„æµ‹çš„æ–¹æ³•. å†ç¼–è¯‘è¿è¡Œå³å¯.

  4. ç¨‹åºä¼šå¯¹æ¯ç§æ–¹æ³•è°ƒç”¨åæ¬¡, æœ€åè¾“å‡ºå¹³å‡æ—¶é—´

## æ–‡ä»¶ç»“æ„:

- Makefile : makeç¼–è¯‘cppæ–‡ä»¶
- data.txt : æ¯è¡Œä¸€ä¸ªæ•´æ•°, ä¸€å…± 1000,0000ä¸ª (ç¬¬ä¸€æ¬¡ç”Ÿæˆ)
- load_data : pascal ç¼–è¯‘åçš„æ‰§è¡Œç¨‹åº
- load_data.pas : pascal æºç 
- seventh.cpp : å®éªŒc++æºç 
- seventh.out : ç¼–è¯‘åçš„æ‰§è¡Œç¨‹åº

## å®éªŒç»“æœ

| æ–¹æ³•         | å¹³å‡æ—¶é—´(s) |
|--------------|-------------|
| cin          | 3.93276     |
| scanf        | 1.57656     |
| fread        | 0.45389     |
| read         | 0.42889     |
| mmap         | 0.41451     |
| pascal       | 1.41711     |
| ifstream     | 0.99613     |
| cin~sync     | 1.06971     |
| cin~tie      | 3.87770     |
| cin~tie~sync | 1.02246     |

## ç»“è®º

1. ç”±ç»“æœæ¥çœ‹ sync_with_stdio() æ˜¯é˜»ç¢ cin é€Ÿåº¦çš„å…³é”®.
2. cin.tie() å¯ä»¥ç¨å¾®å†è®© cin çš„é€Ÿåº¦å¿«ä¸€ç‚¹ç‚¹
3. sync_with_stdio() å…³é—­å, cin æ¯” scanf è¿˜è¦å¿«
4. pascal å’Œ scanf ç›¸å½“
5. ifsteram çš„é€Ÿåº¦æ¯” cin ä» stdin è¦å¿«
6. å…ˆè¯»è¿›å†…å­˜å†å¤„ç†çš„æœ‰ fread, read, mmap. å…¶ä¸­ read å’Œ mmap ç›¸å½“, fread ç¨æ…¢ä¸€ç‚¹ç‚¹.
7. å…ˆæ•´ä¸ªè¯»è¿›å†…å­˜å†å¤„ç†æ¯”ä»æ–‡ä»¶è¯»å–å¿«å¾ˆå¤š, å¤§æ¦‚åªè¦0.5s, ä½†æ˜¯è¿™æ˜¯ç‰ºç‰²äº†å†…å­˜ç©ºé—´æ¢æ¥çš„.